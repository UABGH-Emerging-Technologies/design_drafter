<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://sites.uab.edu/periop-datascience/architecture.html" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Architecture - UMLBot</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Architecture";
        var mkdocs_page_input_path = "architecture.md";
        var mkdocs_page_url = "/periop-datascience/architecture.html";
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> UMLBot
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="tests/index.html">Tests</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">UMLBot</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="UMLBot/__init__.html">Package Init</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="UMLBot/api_server.html">API Server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="UMLBot/exceptions.html">Exceptions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="UMLBot/llm_interface.html">LLM Interface</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="UMLBot/uml_draft_handler.html">UML Draft Handler</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Services</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="UMLBot/services/__init__.html">Init</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="UMLBot/services/diagram_service.html">Diagram Service</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Utils</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="UMLBot/utils/plantuml_extractor.html">PlantUML Extractor</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Config</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="UMLBot/config/__init__.html">Init</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="UMLBot/config/config.html">Config</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="UMLBot_streamlit_app.html">User Interface</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">llm_utils</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="llm_utils/index.html">Home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Fast API</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/fastapi/helper_apis.html">Helper APIS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/fastapi/schemas.html">Schemas</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/fastapi/validators.html">Validators</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >File Operations</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/file_operations/docx_creator.html">Docx Creator</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/file_operations/file_config.html">File Config</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/file_operations/file_handling.html">File Handling</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/file_operations/text_format.html">Text Format</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/file_operations/upload_manager.html">Upload Manager</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Resource</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/resource/default_resource_config.html">Default Resource Config</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/resource/NIHRePORTERInterface.html">NIH RePORTER Interface</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/resource/PubMedInterface.html">PubMed Interface</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/resource/PubMedQuery.html">PubMed Query</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Streamlit</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/streamlit/BYOKLogin.html">Bring Your Own Key (BYOK)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/streamlit/streamlit_common.html">Streamlit Common</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="llm_utils/aiweb_common/ObjectFactory.html">Object Factory</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="llm_utils/aiweb_common/WorkflowHandler.html">Workflow Handler</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Generate</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/AugmentedResponse.html">AugmentedResponse</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/AugmentedServicer.html">AugmentedServicer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/ChatResponse.html">ChatResponse</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/ChatSchemas.html">ChatSchemas</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/ChatServicer.html">ChatServicer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/PromptAssembler.html">PromptAssembler</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/PromptyResponseHandler.html">PromptyResponse</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/PromptyServicer.html">PromptyServicer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/QueryInterface.html">QueryInterface</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/Response.html">Response</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/SingleResponse.html">SingleResponse</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="llm_utils/aiweb_common/generate/SingleResponseServicer.html">SingleResponseServicer</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">UMLBot</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Architecture</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/uabperiopai/edit/master/docs/architecture.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p><strong>System Component to Code Module and LLM Utility Mapping</strong></p>
<p><strong>UI Layer</strong>
- Gradio UI: Handles user input, diagram type selection, preview, and download.
  - Code: <code>GradioInterface</code> (to be implemented in the main app, e.g., <a href="UMLBot_streamlit_app.html"><code>UMLBot_streamlit_app.md</code></a> or a new UI module)
  - Interacts with: <code>ChatBotService</code> (service layer)</p>
<p><strong>Service Layer</strong>
- ChatBotService: Orchestrates the flow from user request to diagram generation.
  - Code: New module/class, e.g., <code>UMLBot/service/chatbot_service.py</code>
  - Uses: <code>NLPParser</code>, <code>DiagramBuilder</code>
- NLPParser: Converts free text to UML constructs using LLM.
  - Code: New module/class, e.g., <code>UMLBot/service/nlp_parser.py</code>
  - Leverages: <code>llm_utils/aiweb_common/generate/ChatServicer.py</code>, <code>PromptAssembler.py</code> for LLM calls and prompt construction.
- DiagramBuilder: Builds PlantUML code from parsed model, manages validation and repair.
  - Code: New module/class, e.g., <code>UMLBot/service/diagram_builder.py</code>
  - Uses: <code>PlantUMLValidator</code>, <code>ThemeManager</code>, <code>PlantUmlClient</code>
- PlantUMLValidator &amp; AutoRepairStrategy: Validate and repair PlantUML code.
  - Code: New module/class, e.g., <code>UMLBot/service/plantuml_validator.py</code>
  - Can leverage: LLM utilities for advanced repair (e.g., <code>ChatServicer</code> for LLM-based repair suggestions)
- ThemeManager: Supplies PlantUML themes.
  - Code: New module/class, e.g., <code>UMLBot/service/theme_manager.py</code></p>
<p><strong>Infrastructure Layer</strong>
- PlantUmlClient: Renders PlantUML code (remote or local).
  - Code: New module/class, e.g., <code>UMLBot/infrastructure/plantuml_client.py</code>
  - Implements: HTTP and local JAR rendering, with failover logic.
- Database, Auth, Monitoring: Standard integrations for user/session/history, authentication, and logging.
  - Code: To be implemented as needed, e.g., <code>UMLBot/infrastructure/db.py</code>, <code>auth.py</code>, <code>monitoring.py</code></p>
<p><strong>Supporting Services</strong>
- DownloadController: Serves images to the UI.
  - Code: Part of UI or a small API endpoint.</p>
<hr />
<p><strong>Chat-Based UML Revision Workflow</strong></p>
<ul>
<li>The chat workflow enables users to iteratively describe, revise, and correct UML diagrams through conversational interaction.</li>
<li>The UI (Gradio/Streamlit) relays user messages to the service layer, which orchestrates prompt construction, LLM invocation, and diagram updates.</li>
<li>Each chat turn can request new features, corrections, or explanations; the system updates the PlantUML code and diagram accordingly.</li>
<li>The workflow supports error correction by leveraging LLM-based auto-repair and surfacing actionable feedback to the user.</li>
</ul>
<p><strong>Generic Error Handler Integration</strong></p>
<ul>
<li>The generic error handler is integrated across all layers:</li>
<li>UI: Displays status and error messages, provides fallback diagrams.</li>
<li>Service: Captures errors from LLM, prompt, and rendering steps; attempts auto-correction.</li>
<li>Infrastructure: Handles network and rendering failures, reporting issues to the service layer.</li>
<li>All errors are routed through the error handler, ensuring transparency and robust recovery.</li>
</ul>
<hr />
<p><strong>LLM Utility Integration</strong>
- All LLM calls (NLP parsing, auto-repair, chat-based revision, error handling) should use the <code>llm_utils/aiweb_common/generate/</code> classes:
  - <code>ChatServicer</code> for conversational LLM calls.
  - <code>PromptAssembler</code> for prompt construction.
  - <code>QueryInterface</code> for abstraction.
  - <code>ObjectFactory</code> for extensibility (e.g., plugin new diagram types).
  - <code>WorkflowHandler</code> for orchestrating multi-step flows and logging.
  - <code>GenericErrorHandler</code> for capturing, reporting, and auto-correcting errors.</p>
<p>This mapping ensures that all LLM-related logic and error handling are centralized and reusable, following the project's coding standards and leveraging the common codebase.</p>
<p>Next steps: Specify in detail how and where to leverage these LLM interface classes and error handler in the design.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="index.html" class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="tests/index.html" class="btn btn-neutral float-right" title="Tests">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/uabperiopai" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="index.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="tests/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
